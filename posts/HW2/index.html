<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.541">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jamie">
<meta name="dcterms.date" content="2024-02-06">

<title>Jamie’s Blog - Movie or TV Show Recommendation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Jamie’s Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Movie or TV Show Recommendation</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">HOMEWORK</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Jamie </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 6, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Unleashing the Power of Scrapy: Scraping and Recommending Movies and TV Shows from TMDB</p>
<div id="ddc25f52-9289-4392-974f-fc16b06f6d10" class="cell" data-tags="[]" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.io <span class="im">as</span> pio</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>pio.renderers.default<span class="op">=</span><span class="st">"iframe"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="intro" class="level2">
<h2 class="anchored" data-anchor-id="intro">Intro</h2>
<p>Welcome to the world of web scraping and data-driven recommendations! In today’s digital era, where information is abundant and readily accessible, leveraging the power of data extraction tools like Scrapy opens up a realm of possibilities. In this tutorial, we’ll embark on a journey to scrape data from TMDB (The Movie Database), a treasure trove of information about movies and TV shows. But we’re not stopping there; we’ll dive deeper into the web of interconnected data, exploring the crew members’ profiles and unraveling the threads of their acting history.</p>
<p>Using Scrapy, a powerful and versatile web crawling framework in Python, we’ll navigate through TMDB’s vast database with ease. Our mission? To gather detailed insights into specific movie and TV show pages, extract information about the cast and crew, and then traverse the web of actor profiles to unearth their acting repertoire. By analyzing the overlaps in their performances, we’ll construct a recommendation engine that suggests similar movies or TV shows based on shared talent.</p>
<p>Whether you’re a data enthusiast, a budding web developer, or simply curious about the magic behind personalized recommendations, this tutorial will equip you with the tools and knowledge to embark on your scraping and recommendation journey. So, let’s roll up our sleeves, fire up our code editors, and dive headfirst into the fascinating world of Scrapy and TMDB scraping!</p>
</section>
<section id="table-of-contents" class="level2">
<h2 class="anchored" data-anchor-id="table-of-contents">Table of Contents</h2>
<section id="web-scraper" class="level3">
<h3 class="anchored" data-anchor-id="web-scraper">1. Web Scraper</h3>
<pre><code>1.1 Setup
    1.1.1 Setting up a Scrapy Project
    1.1.2 Test Scrapy for TMDB Scraping
1.2 Implementation</code></pre>
</section>
<section id="visualization-and-recommendation" class="level3">
<h3 class="anchored" data-anchor-id="visualization-and-recommendation">2. Visualization and Recommendation</h3>
</section>
</section>
<section id="web-scraper-1" class="level2">
<h2 class="anchored" data-anchor-id="web-scraper-1">1. Web Scraper</h2>
<section id="setup" class="level3">
<h3 class="anchored" data-anchor-id="setup">1.1 Setup</h3>
<section id="setting-up-a-scrapy-project" class="level4">
<h4 class="anchored" data-anchor-id="setting-up-a-scrapy-project">1.1.1 Setting up a Scrapy Project</h4>
<p>In this section, we’ll walk through the process of setting up a Scrapy project to scrape data from TMDB (The Movie Database). By following these steps, you’ll be able to create a structured project environment ready for web scraping.</p>
<section id="step-1-activate-your-conda-environment" class="level5">
<h5 class="anchored" data-anchor-id="step-1-activate-your-conda-environment">Step 1: Activate Your Conda Environment</h5>
<p>Open a terminal or command prompt and activate your Conda environment where you want to set up your Scrapy project. Type the following command:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> activate PIC16B-24W</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This command activates the specified Conda environment named “PIC16B-24W”. Ensure that you have created and configured this environment beforehand.(You can choose whatever environment you have)</p>
</section>
<section id="step-2-create-a-scrapy-project" class="level5">
<h5 class="anchored" data-anchor-id="step-2-create-a-scrapy-project">Step 2: Create a Scrapy Project</h5>
<p>Now, we’ll create a Scrapy project named “TMDB_scraper”. In your terminal, type the following command:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">scrapy</span> startproject TMDB_scraper</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This command initializes a new Scrapy project named “TMDB_scraper”. Scrapy will generate several files and directories within this project. When you create a Scrapy project using the <code>scrapy startproject</code> command with the name “TMDB_scraper”, the generated project directory (<code>TMDB_scraper</code>) typically contains the following files and directories:</p>
<ol type="1">
<li><p><strong>scrapy.cfg:</strong> This file is the configuration file for your Scrapy project. It contains settings for Scrapy deployment and other global configurations.</p></li>
<li><p><strong>TMDB_scraper/ (directory inside TMDB_scraper/):</strong> This is the Python package directory containing your project’s code.</p>
<ul>
<li><p><strong>items.py:</strong> This file defines the data structure (items) that your spider will extract during scraping. You define the fields you want to extract from the website here.</p></li>
<li><p><strong>middlewares.py:</strong> This file contains the middlewares used by Scrapy, such as user-agent rotation, proxy usage, etc.</p></li>
<li><p><strong>pipelines.py:</strong> This file contains the pipelines used by Scrapy for processing scraped items. Pipelines are used to perform tasks like cleaning, validation, and storing data.</p></li>
<li><p><strong>settings.py:</strong> This file contains Scrapy project settings, such as user-agent, download delay, etc. You can customize these settings according to your requirements.</p></li>
<li><p><strong>spiders/ (directory):</strong> This directory contains your spider scripts.</p>
<ul>
<li><strong>__init__.py:</strong> This file makes the <code>spiders</code> directory a Python package.</li>
</ul></li>
</ul></li>
</ol>
<p>These are the essential files and directories that are created when you initialize a Scrapy project. Depending on your specific requirements and configurations, your project might have additional files or directories.</p>
</section>
<section id="step-3-navigate-to-your-project-directory" class="level5">
<h5 class="anchored" data-anchor-id="step-3-navigate-to-your-project-directory">Step 3: Navigate to Your Project Directory</h5>
<p>Navigate to the newly created project directory “TMDB_scraper” using the <code>cd</code> command:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> TMDB_scraper</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This command changes your current directory to the “TMDB_scraper” directory, where your Scrapy project files are located. From here, you’ll be able to configure and customize your scraping scripts as needed.</p>
<p>Congratulations! You’ve successfully set up a Scrapy project named “TMDB_scraper” ready for web scraping.</p>
</section>
</section>
<section id="test-scrapy-for-tmdb-scraping" class="level4">
<h4 class="anchored" data-anchor-id="test-scrapy-for-tmdb-scraping">1.1.2 Test Scrapy for TMDB Scraping</h4>
<p>We’ll start by configuring settings in the <code>settings.py</code> file to prevent excessive data downloads and avoid being blocked by the website. Then, we’ll explore using the Scrapy shell for interactive testing and debugging.</p>
<section id="step-1-modify-settings.py-to-limit-page-count" class="level5">
<h5 class="anchored" data-anchor-id="step-1-modify-settings.py-to-limit-page-count">Step 1: Modify <code>settings.py</code> to Limit Page Count</h5>
<p>Open the <code>settings.py</code> file located in your Scrapy project directory (<code>TMDB_scraper</code>) using a text editor. Add the following line to limit the number of pages to be scraped:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>CLOSESPIDER_PAGECOUNT <span class="op">=</span> <span class="dv">20</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This line prevents the scraper from downloading too much data during testing. Remember to remove this line later for full-scale scraping.</p>
</section>
<section id="step-2-configure-user-agent-to-mimic-a-web-browser" class="level5">
<h5 class="anchored" data-anchor-id="step-2-configure-user-agent-to-mimic-a-web-browser">Step 2: Configure User-Agent to Mimic a Web Browser</h5>
<p>To avoid getting blocked by TMDB, we’ll mimic a web browser’s behavior by modifying the <code>USER_AGENT</code> in the <code>settings.py</code> file. Replace the existing <code>USER_AGENT</code> line with the following:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>USER_AGENT <span class="op">=</span> <span class="st">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This user-agent string resembles a typical web browser’s user-agent, which makes it less likely for TMDB to block our requests.</p>
<p>Or you can use other methods:</p>
<p>https://doc.scrapy.org/en/latest/topics/practices.html#avoiding-getting-banned</p>
<p>https://scrapeops.io/python-scrapy-playbook/scrapy-403-unhandled-forbidden-error/</p>
<p>https://scrapeops.io/web-scraping-playbook/403-forbidden-error-web-scraping/</p>
<p>https://scrapingrobot.com/blog/most-common-user-agents/</p>
</section>
<section id="step-3-test-scraping-with-scrapy-shell" class="level5">
<h5 class="anchored" data-anchor-id="step-3-test-scraping-with-scrapy-shell">Step 3: Test Scraping with Scrapy Shell</h5>
<p>Now, let’s test our scraping capability using Scrapy shell. Open a terminal or command prompt and navigate to your Scrapy project directory (<code>TMDB_scraper</code>). Then, run the following command:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">scrapy</span> shell https://www.themoviedb.org/movie/157336-interstellar/cast</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Replace the URL with the desired TMDB page to scrape. Here I used Interstellar. This command launches the Scrapy shell with the specified user-agent and the provided URL.</p>
<p>Stay tuned for the next part of this tutorial series where we’ll explore writing spider scripts and extracting data from TMDB using Scrapy.</p>
</section>
</section>
</section>
<section id="website-navigation" class="level3">
<h3 class="anchored" data-anchor-id="website-navigation">1.2 Website Navigation</h3>
<p>Before writing the scraper method, we need to have a basic idea of what the website looks like and what information we need to scrap from the website.</p>
<p>Start by visiting the website you want to scrape. In our case, it’s TMDB (The Movie Database). Browse through different pages, such as movie pages and the Full Cast &amp; Crew page, to get familiar with the layout and structure.</p>
<section id="explore-the-website" class="level5">
<h5 class="anchored" data-anchor-id="explore-the-website">Explore the Website</h5>
<p>Start by visiting the TMDB website and navigating to the movie page of interest. For our example, let’s consider the movie “Interstellar”. You can find its page at:</p>
<p><a href="https://www.themoviedb.org/movie/157336-interstellar">Interstellar Movie Page</a></p>
<p>The url is: https://www.themoviedb.org/movie/157336-interstellar</p>
<p>This is the url that we want to start with in the <code>__init__</code>, where we define the start url, that can be modified with whatever movie or tv show names after the slash movie.</p>
</section>
<section id="identify-relevant-pages" class="level5">
<h5 class="anchored" data-anchor-id="identify-relevant-pages">Identify Relevant Pages</h5>
<p>Once on the movie page, explore the different sections and links available. In our case, we’re interested in extracting information about the movie’s cast. We’ll navigate to the Full Cast &amp; Crew page by appending “/cast” to the movie page URL:</p>
<p><a href="https://www.themoviedb.org/movie/157336-interstellar/cast">Interstellar Cast Page</a></p>
<p>The url is: https://www.themoviedb.org/movie/157336-interstellar/cast</p>
<p>Note that there is a ‘cast’ was added at the end of the initial url and that is what we are going to do in the <code>parse</code> method.</p>
<p>For the other 2 method <code>parse_full_credits</code> and <code>parse_actor_page</code> we need to dig deeper to the page construction. Here I am just going to introduce the overall structer of the TmdbSpider class.</p>
</section>
<section id="plan-scraping-strategy" class="level5">
<h5 class="anchored" data-anchor-id="plan-scraping-strategy">Plan Scraping Strategy</h5>
<p>Now that we’ve identified the relevant pages, we can plan our scraping strategy. We’ll create a Scrapy spider with the following methods:</p>
<ul>
<li><code>parse</code>: Navigates to the Full Cast &amp; Crew page and calls <code>parse_full_credits</code>.</li>
<li><code>parse_full_credits</code>: Extracts information about the cast members and navigates to each actor’s personal page.</li>
<li><code>parse_actor_page</code>: Extracts the actor’s acting history from their personal page.</li>
</ul>
<p>Understanding the structure of the website you’re scraping is essential for developing an effective scraping method. By exploring different pages, identifying relevant information, and planning your scraping strategy, you’ll be better prepared to write the scraper method and extract the desired data.</p>
<p>Once we’ve outlined the blueprint of our class, the next step is bringing our plan to life. In web scraping, this primarily involves inspecting and extracting data. Once we understand the data structure, our task is to pinpoint its location within the HTML and then select the most appropriate method for extraction.</p>
</section>
<section id="inspect-elements" class="level5">
<h5 class="anchored" data-anchor-id="inspect-elements">Inspect Elements</h5>
<p>Most modern web browsers offer developer tools that allow you to inspect the HTML and CSS of web pages. Right-click on any element of interest (e.g., movie title, actor name) and select “Inspect” or “Inspect Element” from the context menu.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/1e4aea55-9011-4bb3-b41b-d6c3fa35fbc4-1-bb63507d-c4c3-4ad2-8d62-456018f6da02.png" class="img-fluid figure-img"></p>
<figcaption>image.png</figcaption>
</figure>
</div>
<p>You can see it at the bottom!</p>
</section>
<section id="identify-data-to-scrape" class="level5">
<h5 class="anchored" data-anchor-id="identify-data-to-scrape">Identify Data to Scrape</h5>
<p>Once you’re in the developer tools, explore the HTML structure to identify the elements containing the data you want to scrape. Look for unique identifiers such as class names, IDs, or tag names that can help you locate the desired information. I will guide you with the details later, don’t worry.</p>
</section>
<section id="plan-scraping-strategy-1" class="level5">
<h5 class="anchored" data-anchor-id="plan-scraping-strategy-1">Plan Scraping Strategy</h5>
<p>Based on the information you want to extract and its location in the HTML structure, plan your scraping strategy. Determine which Scrapy selectors (e.g., CSS selectors, XPath expressions) you’ll use to target and extract the data.</p>
<p>You might want to get familar with these before we proceed:</p>
<p><code>Request objects</code>: https://docs.scrapy.org/en/latest/topics/request-response.html#request-objectsLinks</p>
<p><code>Response objects</code>: https://docs.scrapy.org/en/latest/topics/request-response.html#response-objectsLinks</p>
<p><code>Selector objects</code>: https://docs.scrapy.org/en/latest/topics/selectors.html#scrapy.selector.Selector</p>
</section>
</section>
<section id="implementation" class="level3">
<h3 class="anchored" data-anchor-id="implementation">1.3 Implementation</h3>
<p>In this section, we’ll create a Scrapy spider named <code>tmdb_spider.py</code> to scrape data from TMDB (The Movie Database) for a specific movie. We’ll set it up to accept the movie’s subdirectory as a command-line argument for easy customization.</p>
<section id="step-1-create-tmdb_spider.py" class="level4">
<h4 class="anchored" data-anchor-id="step-1-create-tmdb_spider.py">Step 1: Create <code>tmdb_spider.py</code></h4>
<p>Inside the <code>spiders</code> directory of your Scrapy project (<code>TMDB_scraper</code>), create a new Python file named <code>tmdb_spider.py</code>. You can do this manually or by running the following command in your terminal:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> TMDB_scraper/spiders/tmdb_spider.py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Open this file in a text editor and add the following lines:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scrapy</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TmdbSpider(scrapy.Spider):</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> <span class="st">'tmdb_spider'</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, subdir<span class="op">=</span><span class="va">None</span>, <span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.start_urls <span class="op">=</span> [<span class="ss">f"https://www.themoviedb.org/movie/</span><span class="sc">{</span>subdir<span class="sc">}</span><span class="ss">/"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>__init__</code> method in the spider class initializes the spider with the provided subdirectory argument. This allows us to customize the URL to scrape based on the movie’s subdirectory.</p>
<p>To run the spider and scrape data for a specific movie, use the following command:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">scrapy</span> crawl tmdb_spider <span class="at">-o</span> movies.csv <span class="at">-a</span> subdir=671-harry-potter-and-the-philosopher-s-stone</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Replace <code>671-harry-potter-and-the-philosopher-s-stone</code> with the subdirectory of the movie you want to scrape. This command instructs Scrapy to crawl the specified URL and save the scraped data to a CSV file named <code>movies.csv</code>.</p>
<p>You’ve successfully created a Scrapy spider named <code>tmdb_spider.py</code> configured to scrape data from TMDB for a specific movie. By providing the movie’s subdirectory as a command-line argument, you can easily customize the spider to scrape data for different movies.</p>
<p>Here’s a basic outline of the <code>TmdbSpider</code> class:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scrapy</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TmdbSpider(scrapy.Spider):</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> <span class="st">'tmdb_spider'</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, subdir<span class="op">=</span><span class="va">None</span>, <span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.start_urls <span class="op">=</span> [<span class="ss">f"https://www.themoviedb.org/movie/</span><span class="sc">{</span>subdir<span class="sc">}</span><span class="ss">/"</span>]</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse(<span class="va">self</span>, response):</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Navigate to the Full Cast &amp; Crew page</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_full_credits(<span class="va">self</span>, response):</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract information about the cast members</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Navigate to each actor's personal page</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Call parse_actor_page for each actor</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_actor_page(<span class="va">self</span>, response):</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract the actor's acting history from their personal page</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="parseself-response" class="level4">
<h4 class="anchored" data-anchor-id="parseself-response">1.2.1 parse(self, response)</h4>
<p>In the <code>parse</code> method: - We construct the URL for the Full Cast &amp; Crew page by appending “cast” to the movie page’s URL. - We then yield a <code>scrapy.Request</code> object with the URL of the Full Cast &amp; Crew page and specify <code>parse_full_credits</code> as the callback method.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scrapy</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TmdbSpider(scrapy.Spider):</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> <span class="st">'tmdb_spider'</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, subdir<span class="op">=</span><span class="va">None</span>, <span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.start_urls <span class="op">=</span> [<span class="ss">f"https://www.themoviedb.org/movie/</span><span class="sc">{</span>subdir<span class="sc">}</span><span class="ss">/"</span>]</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse(<span class="va">self</span>, response):</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Navigate to the Full Cast &amp; Crew page by adding "cast" after the start URL</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        full_credits_url <span class="op">=</span> response.url <span class="op">+</span> <span class="st">"cast"</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># After navigation, call parse_full_credits</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> scrapy.Request(full_credits_url, callback<span class="op">=</span><span class="va">self</span>.parse_full_credits)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s break down each part of the provided code snippet:</p>
<ol type="1">
<li><p><code>def parse(self, response):</code> This is a method definition in a Scrapy spider class. It’s the default method called by Scrapy to handle responses downloaded for each request made.</p></li>
<li><p><code>full_credits_url = response.url + "cast"</code>: This line of code constructs the URL for the Full Cast &amp; Crew page. It takes the current URL of the response object and appends “cast” to it, which is the relative URL for the Full Cast &amp; Crew page.</p></li>
<li><p><code>yield scrapy.Request(full_credits_url, callback=self.parse_full_credits)</code>: This line of code yields a new Scrapy Request object. Scrapy uses <code>Request</code> and <code>Response</code> objects for crawling web sites.Typically, Request objects are generated in the spiders and pass across the system until they reach the Downloader, which executes the request and returns a Response object which travels back to the spider that issued the request. This initiates a new request to the <code>full_credits_url</code> URL and specifies <code>self.parse_full_credits</code> as the callback function to handle the response.</p></li>
</ol>
<p>In summary, this <code>parse</code> method is responsible for constructing a request to navigate to the Full Cast &amp; Crew page and then calling the <code>parse_full_credits</code> method to handle the response from that page.</p>
</section>
<section id="parse_full_creditsself-response" class="level4">
<h4 class="anchored" data-anchor-id="parse_full_creditsself-response">1.2.2 parse_full_credits(self, response)</h4>
<p>The overall code looks like this:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_full_credits(<span class="va">self</span>, response):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    cast_list <span class="op">=</span> response.css(<span class="st">'h3:contains("Cast") + ol li div.info'</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> actor <span class="kw">in</span> cast_list:</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        actor_url <span class="op">=</span> actor.css(<span class="st">"a::attr(href)"</span>).get()</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        actor_page_url <span class="op">=</span> response.urljoin(actor_url)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> scrapy.Request(actor_page_url, callback<span class="op">=</span><span class="va">self</span>.parse_actor_page)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol type="1">
<li><p><code>def parse_full_credits(self, response):</code> This is a method definition within a Scrapy spider class. It’s intended to handle the response from the Full Cast &amp; Crew page.</p></li>
<li><p><code>cast_list = response.css('h3:contains("Cast") + ol li div.info')</code>: This line of code uses CSS selectors to locate the elements containing information about each actor in the cast. It selects the <code>&lt;div&gt;</code> elements with the class “info” that are within list items <code>(&lt;li&gt;)</code> following an <code>&lt;ol&gt;</code> element immediately after an <code>&lt;h3&gt;</code> element containing the text “Cast” since we only want the Cast section instead of Crew. For how to use selector, make sure go through this: https://docs.scrapy.org/en/latest/topics/selectors.html</p></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/3d5da649-dc42-4a6d-98f9-5ecadadcf14c-1-c22fdb58-f0a3-46db-965a-8c4637a57f20.png" class="img-fluid figure-img"></p>
<figcaption>image.png</figcaption>
</figure>
</div>
<p>Now we have all the casts information, we need to extract each person’s page url by iteration.</p>
<ol start="3" type="1">
<li><p><code>for actor in cast_list:</code>: This loop iterates over each element in the cast_list.</p></li>
<li><p><code>actor_url = actor.css("a::attr(href)").get()</code>: Within each iteration of the loop, this line of code extracts the URL of the actor’s personal page. It selects the value of the “href” attribute of the <code>&lt;a&gt;</code> element within the current actor’s <code>&lt;div&gt;</code> as you see in the screenshot above.</p></li>
<li><p><code>actor_page_url = response.urljoin(actor_url)</code>: This line constructs the absolute URL for the actor’s personal page by joining the relative URL extracted in the previous step with the base URL of the current response.</p></li>
<li><p><code>yield scrapy.Request(actor_page_url, callback=self.parse_actor_page)</code>: Finally, this line yields a new Scrapy Request object for each actor’s personal page. It specifies self.parse_actor_page as the callback function to handle the response from each actor’s page.</p></li>
</ol>
<p>In summary, this parse_full_credits method is responsible for extracting the URLs of each actor’s personal page from the Full Cast &amp; Crew page and yielding requests to scrape data from those individual pages using the parse_actor_page method.</p>
</section>
<section id="parse_actor_pageself-response" class="level4">
<h4 class="anchored" data-anchor-id="parse_actor_pageself-response">1.2.3 parse_actor_page(self, response)</h4>
<p>In this tutorial, we’ll cover how to scrape data from an actor’s personal page, focusing on extracting their past or current movies or TV shows.</p>
<p>The overall code looks like this:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_actor_page(<span class="va">self</span>, response):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Yield a dictionary for each movie or TV show the actor has worked in an "Acting" role</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    actor_name <span class="op">=</span> response.css(<span class="st">'div.title h2.title a::text'</span>).get()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    acting_table <span class="op">=</span> response.css(<span class="st">'h3:contains("Acting") + table.card.credits'</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    name_list <span class="op">=</span> acting_table.css(<span class="st">"a.tooltip"</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> name <span class="kw">in</span> name_list:</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>        movie_or_TV_name <span class="op">=</span> name.css(<span class="st">"bdi::text"</span>).get() </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> {<span class="st">"actor"</span>: actor_name, <span class="st">"movie_or_TV_name"</span>: movie_or_TV_name}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/aa788ee6-312d-4d71-9b83-4d48037755df-1-55ccf44a-86a7-497d-ad62-c48c1df28051.png" class="img-fluid figure-img"></p>
<figcaption>image.png</figcaption>
</figure>
</div>
<ol type="1">
<li><code>actor_name = response.css('div.title h2.title a::text').get()</code>: This line extracts the actor’s name from the title of their personal page, which is under <code>&lt;div class='title'&gt;</code>, then under <code>&lt;h2 class='title'&gt;</code> then inside the <code>&lt;a&gt;``&lt;/a&gt;</code> here we can get the name of the actor and store it in the <code>actor_name</code>, which also can be done in pervious method, feel free to try it out!</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/aa788ee6-312d-4d71-9b83-4d48037755df-4-e971134e-010c-4579-870a-76793b448332.png" class="img-fluid figure-img"></p>
<figcaption>image.png</figcaption>
</figure>
</div>
<ol start="2" type="1">
<li><code>acting_table = response.css('h3:contains("Acting") + table.card.credits')</code>: This line selects the table containing the actor’s acting credits. It looks for the heading “Acting” and then selects the adjacent table with the class “card” and “credits”. Note that there are several tables under the <code>&lt;div class='credits_list'&gt;</code> make sure you only capture the table with Acting as the header.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/aa788ee6-312d-4d71-9b83-4d48037755df-3-8616c361-59c5-492e-ab44-f84beff45003.png" class="img-fluid figure-img"></p>
<figcaption>image.png</figcaption>
</figure>
</div>
<ol start="3" type="1">
<li><p><code>name_list = acting_table.css("a.tooltip")</code>: This line selects all the name of a movie or TV show in which the actor has acted.</p></li>
<li><p><code>for name in name_list:</code>: This loop iterates over each link in the <code>name_list</code> since we only want the text part of the list.</p></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/aa788ee6-312d-4d71-9b83-4d48037755df-2-5c8b5ae3-2765-4bcb-ad11-6cc4b3fc0351.png" class="img-fluid figure-img"></p>
<figcaption>image.png</figcaption>
</figure>
</div>
<ol start="5" type="1">
<li><p><code>movie_or_TV_name = name.css("bdi::text").get()</code>: Within each iteration of the loop, this line extracts the text representing the name of the movie or TV show from the link.</p></li>
<li><p><code>yield {"actor": actor_name, "movie_or_TV_name": movie_or_TV_name}</code>: Finally, this line yields a dictionary containing the actor’s name and the name of the movie or TV show they acted in.</p></li>
</ol>
<p>Finally, we are done with the scraping part. We’ve learned how to extract an actor’s acting roles from their personal page using Scrapy. By understanding the structure of the actor’s page and using appropriate CSS selectors, we were able to extract the desired information effectively.</p>
<p>Now try to run this in terminal to implement the scraper:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">scrapy</span> crawl tmdb_spider <span class="at">-o</span> results.csv <span class="at">-a</span> subdir=157336-interstellar</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Feel free to replace any Movie or TV show you like!</p>
<p>This would give you a <code>results.csv</code> scraped. Before we proceed, remember to remove the restriction in the <code>settings.py</code>.</p>
</section>
</section>
</section>
<section id="visualization-and-recommendation-1" class="level2">
<h2 class="anchored" data-anchor-id="visualization-and-recommendation-1">2. Visualization and Recommendation</h2>
<div id="70a6a269-f4a2-4b7f-8ac4-aaecc67396dc" class="cell" data-tags="[]" data-execution_count="3">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import libraries</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotly <span class="im">import</span> express <span class="im">as</span> px</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s import this file into our notebook to see what we got!</p>
<div id="f15396e5-d972-46bd-bde1-5b722fb3e49d" class="cell" data-tags="[]" data-execution_count="4">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"results.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="d39aab30-c4c6-435b-99d2-7d44b1a8b919" class="cell" data-tags="[]" data-execution_count="5">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 2063 entries, 0 to 2062
Data columns (total 2 columns):
 #   Column            Non-Null Count  Dtype 
---  ------            --------------  ----- 
 0   actor             2063 non-null   object
 1   movie_or_TV_name  2063 non-null   object
dtypes: object(2)
memory usage: 32.4+ KB</code></pre>
</div>
</div>
<p>We’ve got 2063 movies and TV shows!</p>
<div id="0a88433b-2a83-44c9-b222-8f7de879c9d4" class="cell" data-tags="[]" data-execution_count="6">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">actor</th>
<th data-quarto-table-cell-role="th">movie_or_TV_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>William Patrick Brown</td>
<td>Interstellar</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>William Patrick Brown</td>
<td>Mighty Med</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>William Patrick Brown</td>
<td>Friends with Benefits</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>William Patrick Brown</td>
<td>Chuck</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Matthew McConaughey</td>
<td>2024</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let’s determine the overlaps between these movies and TV shows to form the basis of our recommendation. The logic is straightforward: we’ll analyze the movies or TV shows that feature the actors from your favorite movie or show in the highest quantity.</p>
<div id="28558ac3-c865-4f51-9c38-aa1abec69561" class="cell" data-tags="[]" data-execution_count="7">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>recmd_movies_or_TV <span class="op">=</span> pd.DataFrame(df.movie_or_TV_name.value_counts().reset_index())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>df.movie_or_TV_name.value_counts()</code> we extract the <code>movie_or_TV_name</code> column from the dataframe and get unique values of this column with its count through <code>.value_counts()</code>, which would give us a Series. In order to make use of this Series, we reset the index through <code>.reset_index()</code> and transfer it into another data frame via <code>pd.DataFrame()</code>.</p>
<div id="138f62d6-5c44-4680-af38-7cb9c8df3d2a" class="cell" data-tags="[]" data-execution_count="8">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># original column name are movie_or_TV_name and count, we change them to understand it easier into movie names and number of shared actors</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>recmd_movies_or_TV <span class="op">=</span> recmd_movies_or_TV.rename(columns<span class="op">=</span>{<span class="st">'movie_or_TV_name'</span>:<span class="st">'movie names'</span>, <span class="st">'count'</span>:<span class="st">'number of shared actors'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="9b759c67-242f-4596-9f9c-dee276d544d3" class="cell" data-tags="[]" data-execution_count="9">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>recmd_movies_or_TV[<span class="st">'number of shared actors'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>number of shared actors
1     1602
2      107
3       18
4        9
7        6
6        6
9        2
8        2
35       1
10       1
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>What we observe here is that 1602 rows of the data correspond to a single actor. This indicates that these actors are the only ones in the Interstellar crew who have performed in another movie or show, without any other members of the Interstellar crew. The same interpretation applies to the subsequent results, and the output is sorted based on the count.</p>
<p>Next, we may want to split the data to visualize it in two parts, as we are not interested in the solo performances for those 1602 rows, or in movies or TV shows that contain only 2, 3, or 4 members of the full crew. You can define the splitting criteria according to your own preferences; here, I am simply dividing it into <code>recmd_more</code> and <code>recmd_less</code> based on the presence of 4 or more shared actors.</p>
<div id="88af550f-39df-4181-aeb7-bb90e80a771f" class="cell" data-tags="[]" data-execution_count="10">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>recmd_more <span class="op">=</span> recmd_movies_or_TV[recmd_movies_or_TV[<span class="st">'number of shared actors'</span>] <span class="op">&gt;=</span> <span class="dv">4</span> ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ab4b87d7-d3e8-4689-a1b9-0895b728ef47" class="cell" data-tags="[]" data-execution_count="11">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>recmd_less <span class="op">=</span> recmd_movies_or_TV[recmd_movies_or_TV[<span class="st">'number of shared actors'</span>] <span class="op">&lt;</span> <span class="dv">4</span> ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We create a horizontal bar plot using Plotly Express. We specify the DataFrame <code>recmd_more</code> as the data source, set the ‘number of shared actors’ as the x-axis, ‘movie names’ as the y-axis, and provide additional parameters for orientation and text.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.bar(recmd_more, x<span class="op">=</span><span class="st">'number of shared actors'</span>, y<span class="op">=</span><span class="st">'movie names'</span>, orientation<span class="op">=</span><span class="st">'h'</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>             text<span class="op">=</span><span class="st">'number of shared actors'</span>, title<span class="op">=</span><span class="st">'Movie Names and Number of Shared Actors &gt;= 5'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can adjust the position of the text annotations on the bars using the <code>update_traces</code> method.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>fig.update_traces(textposition<span class="op">=</span><span class="st">'outside'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next, we customize the layout of the plot by specifying axis titles, ordering categories, adjusting tick marks, and setting the height of the plot.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    xaxis_title<span class="op">=</span><span class="st">'Number of Shared Actors'</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    yaxis_title<span class="op">=</span><span class="st">'Movie Names'</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    yaxis_categoryorder<span class="op">=</span><span class="st">'total ascending'</span>,  <span class="co"># Optional: Order y-axis categories by total count</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    yaxis<span class="op">=</span><span class="bu">dict</span>(tickmode<span class="op">=</span><span class="st">'linear'</span>),  <span class="co"># Optional: Ensure that y-axis ticks are shown for every movie</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">600</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By following these steps, you can create a customized horizontal bar plot using Plotly Express in Python. Experiment with different parameters and settings to achieve the desired visualization for your data.</p>
<p>Feel free to further customize the plot according to your specific requirements, such as adjusting colors, fonts, or adding annotations.</p>
<p>Here is the full code:</p>
<div id="da1b98c9-7baa-4a3d-94dc-253052088a51" class="cell" data-tags="[]" data-execution_count="13">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.bar(recmd_more, x<span class="op">=</span><span class="st">'number of shared actors'</span>, y<span class="op">=</span><span class="st">'movie names'</span>, orientation<span class="op">=</span><span class="st">'h'</span>,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>             text<span class="op">=</span><span class="st">'number of shared actors'</span>, title<span class="op">=</span><span class="st">'Movie Names and Number of Shared Actors &gt;= 5'</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>fig.update_traces(textposition<span class="op">=</span><span class="st">'outside'</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Customizing the layout</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    xaxis_title<span class="op">=</span><span class="st">'Number of Shared Actors'</span>,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    yaxis_title<span class="op">=</span><span class="st">'Movie Names'</span>,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    yaxis_categoryorder<span class="op">=</span><span class="st">'total ascending'</span>,  <span class="co"># Optional: Order y-axis categories by total count</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    yaxis<span class="op">=</span><span class="bu">dict</span>(tickmode<span class="op">=</span><span class="st">'linear'</span>),  <span class="co"># Optional: Ensure that y-axis ticks are shown for every movie</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">500</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<iframe scrolling="no" width="100%" height="520" src="iframe_figures/figure_13.html" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<p>As we can see from the plot, Interstellar would of course be the top one we would recommend the it appears to be Saturday Night Live, which shares 10 actors. The View, Late Night with Seth Meyers share 9 actors with Interstellar. Well this would be a tool to do the recommand that is super obvious for the reader or the viewer.</p>
<div id="8e59a2ed-b1b1-4db7-9e6b-e22c741e1428" class="cell" data-tags="[]" data-execution_count="44">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(recmd_less[<span class="st">'number of shared actors'</span>], bins<span class="op">=</span><span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">6</span>), kde<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="st">'skyblue'</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Number of Shared Actors'</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Number of Movies/TV Shows'</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of Movies/TV Shows with Less Than 5 Shared Actors'</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Since we cannot plot the thousands rows, we can visualize it through histplot though this provides not that much of the information we need for recommendation.</p>
<p>Now we are going to see that for each actor, the percentage of sole performance on the overall acting histroy, sole performance here means not with any other actors in the Interstellar crew.</p>
<p>Before we begin, let’s define the required columns in our DataFrame:</p>
<ul>
<li><code>isDup</code>: A boolean column indicating whether the movie or TV show is unique. If <code>True</code>, it means there is a duplicate movie or TV show in the DataFrame, indicating it’s not a sole performance.</li>
<li><code>dup_cnt</code>: The count of occurrences where <code>isDup</code> is <code>True</code> or <code>False</code>, grouped by actor and <code>isDup</code>.</li>
<li><code>total_cnt</code>: The total count of all acting roles for each actor.</li>
</ul>
<p>Calculate <code>isDup</code> Column</p>
<p>We’ll calculate the <code>isDup</code> column using the <code>duplicated</code> method, which marks duplicate entries as <code>True</code> and unique entries as <code>False</code>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'isDup'</span>] <span class="op">=</span> df.duplicated(subset<span class="op">=</span>[<span class="st">'movie_or_TV_name'</span>], keep<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Calculate <code>dup_cnt</code> and <code>total_cnt</code> Columns</p>
<p>Next, we’ll calculate the <code>dup_cnt</code> and <code>total_cnt</code> columns using the <code>groupby</code> method along with the <code>transform</code> function to get the count of occurrences for each actor.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'dup_cnt'</span>] <span class="op">=</span> df.groupby([<span class="st">"actor"</span>, <span class="st">'isDup'</span>])[<span class="st">'movie_or_TV_name'</span>].transform(<span class="st">'count'</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'total_cnt'</span>] <span class="op">=</span> df.groupby([<span class="st">"actor"</span>])[<span class="st">'movie_or_TV_name'</span>].transform(<span class="st">'count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dbc1da82-397f-43f5-9e7a-74f49c95c923" class="cell" data-tags="[]" data-execution_count="130">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'isDup'</span>] <span class="op">=</span> df.duplicated(subset<span class="op">=</span>[<span class="st">'movie_or_TV_name'</span>], keep<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'dup_cnt'</span>] <span class="op">=</span> df.groupby([<span class="st">"actor"</span>, <span class="st">'isDup'</span>])[<span class="st">'movie_or_TV_name'</span>].transform(<span class="st">'count'</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'total_cnt'</span>] <span class="op">=</span> df.groupby([<span class="st">"actor"</span>])[<span class="st">'movie_or_TV_name'</span>].transform(<span class="st">'count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b2baf33d-5a87-4e04-b219-aa924706371d" class="cell" data-tags="[]" data-execution_count="137">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="137">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">actor</th>
<th data-quarto-table-cell-role="th">movie_or_TV_name</th>
<th data-quarto-table-cell-role="th">isDup</th>
<th data-quarto-table-cell-role="th">dup_cnt</th>
<th data-quarto-table-cell-role="th">total_cnt</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>William Patrick Brown</td>
<td>Interstellar</td>
<td>True</td>
<td>2</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>William Patrick Brown</td>
<td>Mighty Med</td>
<td>False</td>
<td>2</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>William Patrick Brown</td>
<td>Friends with Benefits</td>
<td>True</td>
<td>2</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>William Patrick Brown</td>
<td>Chuck</td>
<td>False</td>
<td>2</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Matthew McConaughey</td>
<td>2024</td>
<td>False</td>
<td>91</td>
<td>127</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2058</td>
<td>John Lithgow</td>
<td>Dealing: Or the Berkeley-to-Boston Forty-Brick...</td>
<td>False</td>
<td>151</td>
<td>189</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2059</td>
<td>John Lithgow</td>
<td>Great Performances</td>
<td>False</td>
<td>151</td>
<td>189</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2060</td>
<td>John Lithgow</td>
<td>Tony Awards</td>
<td>True</td>
<td>38</td>
<td>189</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2061</td>
<td>John Lithgow</td>
<td>Today</td>
<td>True</td>
<td>38</td>
<td>189</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2062</td>
<td>John Lithgow</td>
<td>Hallmark Hall of Fame</td>
<td>True</td>
<td>38</td>
<td>189</td>
</tr>
</tbody>
</table>

<p>2063 rows × 5 columns</p>
</div>
</div>
</div>
<p>Now we contruct the plot: Let’s break down what each line of code does:</p>
<p><code>px.bar(df, x='total_cnt', y='actor', orientation='h', color='isDup', text='total_cnt', title='Sole/Shared Performance Count for Each Actor')</code>: - This line creates a horizontal bar plot using Plotly Express (<code>px.bar</code>). - The DataFrame <code>df</code> is used as the data source. - The x-axis represents the total count of performances (<code>total_cnt</code>). - The y-axis represents the actors (<code>actor</code>). - The bars are oriented horizontally (<code>orientation='h'</code>). - The color of the bars is determined by the <code>isDup</code> column. - The text annotations on the bars display the total count of performances. - The title of the plot is set to ‘Sole/Shared Performance Count for Each Actor’.</p>
<p><code>fig.update_traces(textposition='outside')</code>: - This line updates the position of the text annotations on the bars to be outside the bars. - By default, the text annotations are placed inside the bars, but setting <code>textposition='outside'</code> moves them outside for better visibility.</p>
<p><code>yaxis_categoryorder='max ascending'</code>: This line specifies the order of categories (actors) on the y-axis based on the maximum value of their associated data points. Categories with higher maximum values will appear towards the top of the plot, while categories with lower maximum values will appear towards the bottom. You can alter the values to experiment.</p>
<p><code>yaxis=dict(tickmode='linear')</code>: This line ensures that the tick marks on the y-axis are displayed in a linear fashion. This is the default behavior, so it’s not necessary to explicitly specify it unless you want to override any previous settings.</p>
<div id="a1576659-daf4-4716-94a2-c6c5988abc83" class="cell" data-tags="[]" data-execution_count="160">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.bar(df, x<span class="op">=</span><span class="st">'total_cnt'</span>, y<span class="op">=</span><span class="st">'actor'</span>, orientation<span class="op">=</span><span class="st">'h'</span>, color<span class="op">=</span><span class="st">'isDup'</span>,</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>             text<span class="op">=</span><span class="st">'total_cnt'</span>, title<span class="op">=</span><span class="st">'Sole/Shared Performance Count for Each Actor'</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>fig.update_traces(textposition<span class="op">=</span><span class="st">'outside'</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Customizing the layout</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    xaxis_title<span class="op">=</span><span class="st">'Number of Shared Actors'</span>,</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    yaxis_title<span class="op">=</span><span class="st">'Movie Names'</span>,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    yaxis_categoryorder<span class="op">=</span><span class="st">'max ascending'</span>,  <span class="co"># Optional: Order y-axis categories by total count</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    yaxis<span class="op">=</span><span class="bu">dict</span>(tickmode<span class="op">=</span><span class="st">'linear'</span>),  <span class="co"># Optional: Ensure that y-axis ticks are shown for every movie</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">600</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<iframe scrolling="no" width="100%" height="620" src="iframe_figures/figure_160.html" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<p>By hovering the plot, we can see that Michael Caine, John Lithgow, and Matt Damon have the greatest number of shared movies or TV shows with other crews in the Interstellar even though Michael Caine, John Lithgow, and Ellen Burstyn have the greatest number of actings. Therefore, we could not only recommand by the number of overlap among movies or shows, but also by the ‘popularity’ of the actor.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>